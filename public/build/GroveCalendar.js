webpackJsonp([3],[function(e,t,n){function a(e){s.findWhere(r,{id:e})||(r=r.concat({id:e,text:e}),o('select[name="focus_area"]').select2({data:r,tags:!0,allowClear:!0,width:"style"}))}function i(e,t){o("#add-event-text").text("   Add Event"),o('#activity-form select[name="activity"]').val(null),o('#activity-form select[name="focus_area"]').select2("val",null),t||o("#add-event").off("click"),e&&(o("#activity-form").hide("fast"),o("#calendar-button-container").show("fast"))}var s=n(3),o=(n(1),n(2));n(93),n(5),n(6);var c=[],r=s.chain(FOCUS_AREAS).keys().sortBy().value().map(function(e){return{id:e,text:e}}),l=function(e){this.googleId=e.googleId,this.name=e.name,this.image=e.image,this.calendar=e.groveCalendar||[],this.option=o("<option>"+e.name+"</option>").attr("value",e.googleId),this.optionRendered=!1,this.eventDisplays=s.map(e.groveCalendar,function(e,t){return new d(this,e,t)}.bind(this))||[]};l.prototype.renderOption=function(e){this.optionRendered||(o(e).append(this.option),this.optionRendered=!0)},l.prototype.renderEvents=function(e){s.each(this.eventDisplays,function(t){t.render(e),a(t.event.focus_area)})},l.prototype.updateSort=function(e,t){var n=this,a=o("#events-list").sortable("toArray",{attribute:"data-index"});a.forEach(function(e,t){e!=t&&(n.eventDisplays[e].index=t,o(n.eventDisplays[e].el).attr("data-index",t))}),this.eventDisplays=s.sortBy(this.eventDisplays,"index"),o("#save-calendar").removeClass("disabled").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle')},l.prototype.renderCalendar=function(e){o("#student-name").text(this.name),o("#title-text").text("'s Grove Cycle"),o("#student-icon").empty().append('<img class="student-icon" src="'+this.image+'">'),i(!0,!1),o(e).empty(),this.renderEvents(e);var t=this;o("#calendar-container").show(),o("#events-list").sortable({stop:t.updateSort.bind(t)}),o("#create-new-event").off("click").on("click",function(e){o("#activity-legend").text("New event for: "+t.name),o("#activity-form").show("fast"),o("#add-event").on("click",function(e){e.preventDefault();var n={},s=o('#activity-form select[name="activity"]').val();n.location=s.split("#")[0],n.activity=s.split("#")[1];var c=t.eventDisplays.length,r=o('#activity-form select[name="focus_area"]').val();n.focus_area=r,a(r),n=new d(t,n,c),t.eventDisplays.push(n),n.render("#events-list"),i(!1,!0),o("#save-calendar").removeClass("disabled").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle')}),o("#cancel-event-add").on("click",function(e){e.preventDefault(),i(!0)})}),o("#save-calendar").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle').addClass("disabled"),o("#save-calendar").off("click").on("click",function(e){o("#save-calendar").empty().text("Saving...").addClass("disabled");var n=t.eventDisplays.map(function(e){return e.event.checkedIn=!1,e.event});o.ajax("/api/grove/"+t.googleId,{method:"PUT",data:JSON.stringify({calendar:n}),contentType:"application/json",success:function(){o("#save-calendar").empty().append('<i class="fa fa-calendar"></i>   Cycle Saved!')},error:function(e,t,n){o("#save-calendar").empty().removeClass("btn-success").addClass("btn-danger").text("Error Saving").removeClass("disabled")}})})};var d=function(e,t,n){this.student=e,this.event=t,this.index=n,this.el=this.createDisplay()};d.prototype.createDisplay=function(){var e="<tr></tr>",t=o("<td></td>").text(this.event.location),n=o("<td></td>").text(this.event.activity),a=o("<td></td>").text(this.event.focus_area),i="<td></td>";this.editButton=o('<button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>'),i=o(i).append(this.editButton);var s="<td></td>";return this.removeButton=o('<button class="btn btn-xs btn-danger"><i class="fa fa-times"></i></button>'),s=o(s).append(this.removeButton),o(e).attr("data-index",this.index).append(t,n,a,i,s)[0]},d.prototype.render=function(e,t){var n=this;if(t){var s=n.el;n.el=n.createDisplay(),o(s).replaceWith(n.el)}else o(e).append(this.el);o(this.editButton).click(function(e){o('#activity-form select[name="activity"]').val(n.event.location+"#"+n.event.activity),o('#activity-form select[name="focus_area"]').select2("val",n.event.focus_area),o("#add-event-text").text("   Save"),o("#activity-form").show("fast",function(){o("#add-event").off("click").one("click",function(e){e.preventDefault();var t=o('#activity-form select[name="activity"]').val();t?(n.event.location=t.split("#")[0],n.event.activity=t.split("#")[1]):(n.event.location="",n.event.activity="");var s=o('#activity-form select[name="focus_area"]').val();n.event.focus_area=s,a(s),i(!0),n.render("#events-list",!0),o("#save-calendar").removeClass("disabled")}),o("#cancel-event-add").on("click",function(e){e.preventDefault(),i(!0)})})}),o(this.removeButton).click(function(e){o(n.el).remove(),n.student.eventDisplays.splice(n.index,1),n.student.eventDisplays.forEach(function(e){e.index>n.index&&e.index--}),i(!0)})},o(function(){s.keys(GROVE_ACTIVITIES).forEach(function(e){var t=o("<optgroup>").attr("label",e);GROVE_ACTIVITIES[e].forEach(function(n){var a=o("<option>").attr("value",[e,n].join("#")).text(n);t.append(a)}),o('select[name="activity"]').append(t)}),o('select[name="focus_area"]').css("width","100%").select2({data:r,tags:!0,width:"style"}),o.get("/api/grove",function(e){c=s.map(s.sortBy(e,"name"),function(e){return student=new l(e),student.renderOption("#student-names-select"),student}),o("#student-names-select").on("change",function(e){var t=s.find(c,{googleId:e.target.value});t.renderCalendar("#events-list")}),o("#student-name-search").on("keyup",function(e){o("#student-names-select").css("visibility","");var t=o(this).val().toLowerCase();s.each(c,function(e){e.name.toLowerCase().match(t)?e.renderOption("#student-names-select"):(o(e.option).remove(),e.optionRendered=!1)}),1===o("#student-names-select option").length&&o("#student-names-select").trigger("change")})})})}]);